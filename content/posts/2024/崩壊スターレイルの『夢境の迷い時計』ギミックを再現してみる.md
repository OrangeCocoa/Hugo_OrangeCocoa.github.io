---
title: "崩壊スターレイルの『夢境の迷い時計』ギミックを再現してみる"
date: "2024-08-02"
draft: true
categories: [ "技術" ]
tags: [ "Unity" ] 
---

ブロックが動かせないとき、ブロックが揺れるアニメーションが再生される。
このとき、鏡に映る位置の何もない空間にも揺れるアニメーションがあった。
このことから、鏡を挟んだ向こう側に透明なブロックがあることがわかる。（実際には鏡がマスクになっているだけ）
（揺れの同期自体はTransformで再現できるが、おそらく揺れた際に周囲のピクセルが歪む処理をシェーダーで行なっているのだろう）

## 
上から
鏡の吊り糸
クロックボーイ
手前のブロック
鏡
奥のブロック
の順にレイヤー構成していると思われる。

・見た目の再現
鏡にMaskをアタッチ
鏡の子要素に、鏡に映るブロックを配置

テクスチャであればヒエラルキーをそのまま
奥のブロック
鏡(Mask)
∟鏡に映るブロック
手前のブロック
クロックボーイ
鏡の吊り糸
の順番になるよう配置すればよい。
3Dモデルで行なう場合はオブジェクトごとにレンダリングしたテクスチャを重ね合わせればOKです。


手前のブロックと鏡に映るブロックの動きをスクリプトで連動（moveによる鏡方向の移動量, rotateによる回転量をそれぞれ*-1）させれば、鏡に映るブロックができる。

## クロックボーイの移動
結論から言えば、鏡の位置とブロックの位置、回転を特定のパターンにすると正解判定となり、道順を示すパーティクルの再生とクロックボーイの移動が始まる。
→ 複数正解の道があるとき、開発側の用意した正解の道以外では動き出さないことがあったことからこれはほぼ確だろう

このときクロックボーイは決まった道を移動するため、A*などの経路探索アルゴリズムを用いることなく決め打ちで動かすものとする。
もちろんパーティクルも同様である。

